sequenceDiagram
  autonumber
  participant C as Client
  participant API as Order API
  participant H as Command Handler
  participant ES as Event Store
  participant P as Projector
  participant R as Read DB

  C->>API: POST /orders { items, client_request_id, payment? }
  API->>H: validate & build CreateOrder command
  H->>ES: stream(client_request_id)
  alt duplicate request
    H-->>API: reuse existing orderId
  else new order
    H->>ES: append(OrderCreated)
    opt payment requested
      H->>ES: append(PaymentRequested)
      Note over H: Outbox dispatch (ADR-0002 Proposed)
    end
    H-->>API: new orderId
  end
  API-->>C: 200/201 { orderId }

  P-->>ES: subscribe(stream)
  ES-->>P: event(OrderCreated)
  P->>R: upsert read model

  C->>API: GET /orders/{id}
  API->>R: query
  R-->>API: OrderView
  API-->>C: 200 OK
